<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Politique √©conomique - Exercices</title>
    <style>
        :root {
            --primary: #cc785c;
            --primary-light: #e8a88c;
            --primary-dark: #a85d45;
            --bg: #f5f5f0;
            --bg-card: #ffffff;
            --text: #2d2d2d;
            --text-light: #666666;
            --border: #e0ddd5;
            --success: #22c55e;
            --success-bg: #dcfce7;
            --error: #ef4444;
            --error-bg: #fee2e2;
            --info: #3b82f6;
            --info-bg: #dbeafe;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 2px solid var(--primary);
            margin-bottom: 30px;
        }

        header h1 {
            color: var(--primary-dark);
            font-size: 2rem;
            margin-bottom: 10px;
        }

        header p {
            color: var(--text-light);
            font-size: 1.1rem;
        }

        /* Menu principal */
        #menu {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .menu-section {
            margin-bottom: 25px;
        }

        .menu-section:last-child {
            margin-bottom: 0;
        }

        .menu-section h3 {
            color: var(--primary-dark);
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .chapter-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--bg);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .chapter-checkbox:hover {
            border-color: var(--primary-light);
        }

        .chapter-checkbox.selected {
            background: var(--primary-light);
            border-color: var(--primary);
        }

        .chapter-checkbox.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .chapter-checkbox input {
            accent-color: var(--primary);
            width: 18px;
            height: 18px;
        }

        .chapter-checkbox span {
            font-size: 0.95rem;
        }

        .mode-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .mode-btn {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: var(--bg-card);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .mode-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background: var(--bg);
        }

        .mode-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .mode-btn .icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .mode-btn .title {
            font-weight: 600;
            color: var(--text);
        }

        .mode-btn .desc {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 5px;
        }

        /* Zone de quiz */
        #quiz {
            display: none;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-card);
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .quiz-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .quiz-info span {
            font-size: 0.95rem;
            color: var(--text-light);
        }

        .quiz-info .score {
            font-weight: 600;
            color: var(--primary-dark);
        }

        .btn-back {
            padding: 8px 16px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn-back:hover {
            background: var(--border);
        }

        /* Carte de question */
        .question-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .question-meta {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-chapter {
            background: var(--info-bg);
            color: var(--info);
        }

        .badge-type {
            background: var(--bg);
            color: var(--text-light);
        }

        .question-text {
            font-size: 1.15rem;
            margin-bottom: 25px;
            line-height: 1.7;
        }

        .answers {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .answer-btn {
            padding: 15px 20px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: var(--bg-card);
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .answer-btn:hover:not(:disabled) {
            border-color: var(--primary);
            background: var(--bg);
        }

        .answer-btn:disabled {
            cursor: default;
            opacity: 1 !important;
            color: var(--text) !important;
            border-color: var(--border);
        }

        .answer-btn.correct {
            border-color: var(--success) !important;
            background: var(--success-bg) !important;
            color: var(--text) !important;
        }

        .answer-btn.incorrect {
            border-color: var(--error) !important;
            background: var(--error-bg) !important;
            color: var(--text) !important;
        }

        /* Explication */
        .explanation {
            margin-top: 20px;
            padding: 20px;
            background: var(--bg);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            display: none;
        }

        .explanation.show {
            display: block;
        }

        .explanation h4 {
            color: var(--primary-dark);
            margin-bottom: 10px;
        }

        .explanation p {
            color: var(--text);
            line-height: 1.7;
        }

        /* Bouton suivant */
        .btn-next {
            display: none;
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 20px;
        }

        .btn-next:hover {
            background: var(--primary-dark);
        }

        .btn-next.show {
            display: block;
        }

        .btn-next {
            white-space: nowrap;
        }

        /* Exercice chiffre */
        .exercise-input {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 20px;
        }

        .exercise-input input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .exercise-input input:focus {
            border-color: var(--primary);
        }

        .exercise-input input:disabled {
            color: var(--text) !important;
            opacity: 1 !important;
            -webkit-text-fill-color: var(--text) !important;
        }

        .exercise-input .unit {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .btn-validate {
            padding: 12px 25px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-validate:hover {
            background: var(--primary-dark);
        }

        /* Simulation */
        .simulation-container {
            margin-top: 20px;
        }

        .simulation-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-group {
            background: var(--bg);
            padding: 15px;
            border-radius: 10px;
        }

        .control-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text);
        }

        .control-group input[type="range"] {
            width: 100%;
            accent-color: var(--primary);
        }

        .control-group .value {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-top: 5px;
        }

        .simulation-result {
            background: var(--primary-light);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .simulation-result .label {
            font-size: 0.95rem;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .simulation-result .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .simulation-explanation {
            margin-top: 20px;
            padding: 15px;
            background: var(--bg);
            border-radius: 8px;
            font-size: 0.95rem;
            color: var(--text-light);
        }

        .graph-container {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid var(--border);
        }

        .graph-container canvas {
            width: 100%;
            height: auto;
        }

        .simulation-results-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .simulation-result-item {
            flex: 1;
            min-width: 150px;
            background: var(--bg);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .simulation-result-item .label {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .simulation-result-item .value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        /* R√©sultats finaux */
        .results-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .results-card h2 {
            color: var(--primary-dark);
            margin-bottom: 20px;
        }

        .results-score {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .results-details {
            color: var(--text-light);
            margin-bottom: 30px;
        }

        .btn-restart {
            padding: 15px 40px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-restart:hover {
            background: var(--primary-dark);
        }

        /* Progress bar */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }

            header h1 {
                font-size: 1.5rem;
            }

            .question-card {
                padding: 20px;
            }

            .quiz-header {
                flex-direction: column;
                gap: 15px;
            }

            .mode-buttons {
                flex-direction: column;
            }

            .exercise-input {
                flex-wrap: wrap;
            }

            .exercise-input .btn-validate {
                width: 100%;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö Politique √©conomique</h1>
            <p>Exercices de r√©vision - Sciences Po</p>
        </header>

        <!-- Menu principal -->
        <div id="menu">
            <div class="menu-section">
                <h3>S√©lectionner les th√®mes</h3>
                <div class="chapters-grid" id="chapters-list">
                    <!-- G√©n√©r√© par JS -->
                </div>
            </div>

            <div class="menu-section">
                <h3>Choisir un mode</h3>
                <div class="mode-buttons">
                    <button class="mode-btn" id="btn-qcm" disabled>
                        <div class="icon">‚úì‚úó</div>
                        <div class="title">QCM</div>
                        <div class="desc">Testez vos connaissances</div>
                    </button>
                    <button class="mode-btn" id="btn-exercice" disabled>
                        <div class="icon">‚àë</div>
                        <div class="title">Exercices</div>
                        <div class="desc">Calculs et applications</div>
                    </button>
                    <button class="mode-btn" id="btn-simulation" disabled>
                        <div class="icon">üìà</div>
                        <div class="title">Simulations</div>
                        <div class="desc">Visualisez les m√©canismes</div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Zone de quiz -->
        <div id="quiz">
            <div class="quiz-header">
                <button class="btn-back" onclick="backToMenu()">Retour au menu</button>
                <div class="quiz-info">
                    <span>Question <span id="current-q">1</span>/<span id="total-q">10</span></span>
                    <span class="score">Score: <span id="score">0</span></span>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>

            <div id="question-container">
                <!-- Genere par JS -->
            </div>
        </div>
    </div>

    <script>
        // ===========================================
        // DONN√âES DU QUIZ
        // ===========================================

        const chapters = [
            { id: 1, name: "La croissance", available: true },
            { id: 2, name: "Politique budg√©taire", available: true },
            { id: 3, name: "Politique mon√©taire", available: false },
            { id: 4, name: "Int√©gration commerciale", available: false },
            { id: 5, name: "Politique de change", available: false },
            { id: 6, name: "UE et zone euro", available: false },
            { id: 7, name: "March√© du travail", available: false },
            { id: 8, name: "Stabilit√© financi√®re", available: false },
            { id: 9, name: "Politique industrielle", available: false },
            { id: 10, name: "Politique fiscale", available: false },
            { id: 11, name: "In√©galit√©s et pauvret√©", available: false },
            { id: 12, name: "Environnement", available: false }
        ];

        // QCM - Format: { chapter, type, question, answers, correct, explanation }
        // Types: "concept", "chiffre", "definition"
        const qcmQuestions = [
            {
                chapter: 1,
                type: "concept",
                question: "La valeur ajout√©e cr√©√©e par une multinationale fran√ßaise √† l'√©tranger est comptabilis√©e dans le PIB de la France.",
                answers: ["Vrai", "Faux"],
                correct: 1,
                explanation: "Le PIB mesure la production r√©alis√©e sur le territoire national, quelle que soit la nationalit√© des producteurs. La valeur ajout√©e cr√©√©e √† l'√©tranger par une entreprise fran√ßaise est comptabilis√©e dans le PIB du pays o√π elle est produite, pas dans le PIB fran√ßais. C'est le PNB (Produit National Brut) qui prend en compte la nationalit√© des facteurs de production."
            },
            {
                chapter: 1,
                type: "concept",
                question: "Un √©cart de production (output gap) n√©gatif signifie que l'√©conomie est en surchauffe.",
                answers: ["Vrai", "Faux"],
                correct: 1,
                explanation: "Un √©cart de production n√©gatif signifie que le PIB effectif est inf√©rieur au PIB potentiel : l'√©conomie sous-utilise ses capacit√©s productives (travail, capital). C'est une situation de sous-emploi des facteurs de production, pas de surchauffe. La surchauffe correspond √† un √©cart de production positif."
            },
            {
                chapter: 1,
                type: "chiffre",
                question: "Quel est l'ordre de grandeur du taux de croissance potentielle de la France ?",
                answers: ["Environ 0,5 %", "Environ 1,2 %", "Environ 2,5 %", "Environ 3,5 %"],
                correct: 1,
                explanation: "Le taux de croissance potentielle de la France est estim√© autour de 1,2 % par an selon les estimations de la Commission europ√©enne et du FMI. Ce taux a significativement baiss√© depuis les Trente Glorieuses (o√π il d√©passait 5 %)."
            },
            {
                chapter: 1,
                type: "definition",
                question: "La productivit√© globale des facteurs (PGF) mesure la part de la croissance non expliqu√©e par l'accumulation des facteurs de production.",
                answers: ["Vrai", "Faux"],
                correct: 0,
                explanation: "La PGF, aussi appel√©e ¬´ r√©sidu de Solow ¬ª, correspond √† la croissance qui n'est pas attribuable √† l'augmentation des quantit√©s de travail et de capital. Elle refl√®te principalement le progr√®s technique, mais aussi l'am√©lioration de l'organisation de la production, l'√©ducation, la qualit√© des institutions, etc."
            },
            {
                chapter: 1,
                type: "definition",
                question: "Le taux de croissance du PIB en volume mesure l'√©volution de la valeur ajout√©e corrig√©e de l'inflation.",
                answers: ["Vrai", "Faux"],
                correct: 0,
                explanation: "Le PIB en volume (ou PIB r√©el) est calcul√© √† prix constants (ceux d'une ann√©e de r√©f√©rence). Cela permet de neutraliser l'effet des variations de prix. C'est l'indicateur pertinent pour mesurer l'√©volution de la production et du niveau de vie, contrairement au PIB en valeur (ou nominal) qui m√©lange effet volume et effet prix."
            },
            {
                chapter: 1,
                type: "chiffre",
                question: "Quel est l'ordre de grandeur de l'√©cart de PIB par habitant entre la France et les √âtats-Unis ?",
                answers: ["La France est environ 10 % en dessous", "La France est environ 30 % en dessous", "La France est environ 50 % en dessous", "Les deux pays sont au m√™me niveau"],
                correct: 1,
                explanation: "La France a un PIB par habitant d'environ 30 % inf√©rieur √† celui des √âtats-Unis. Cet √©cart s'est creus√© depuis les ann√©es 2000 et refl√®te notamment un nombre d'heures travaill√©es plus faible en France, une productivit√© horaire l√©g√®rement inf√©rieure et un taux d'emploi plus bas."
            },
            {
                chapter: 1,
                type: "chiffre",
                question: "Quel est l'ordre de grandeur du PIB de la France en 2024 ?",
                answers: ["Environ 2 000 milliards d'euros", "Environ 2 500 milliards d'euros", "Environ 2 900 milliards d'euros", "Environ 3 400 milliards d'euros"],
                correct: 2,
                explanation: "Le PIB de la France en 2024 est d'environ 2 900 milliards d'euros. √Ä titre d'ordre de grandeur, 1 point de PIB repr√©sente donc environ 30 milliards d'euros."
            },
            {
                chapter: 1,
                type: "definition",
                question: "Comment appelle-t-on le ph√©nom√®ne par lequel un choc n√©gatif (comme une r√©cession) peut r√©duire durablement le PIB potentiel (par exemple via la perte de comp√©tences des ch√¥meurs de longue dur√©e ou le sous-investissement) ?",
                answers: ["L'effet multiplicateur", "L'effet d'hyst√©r√®se", "L'effet d'√©viction", "L'effet de rattrapage"],
                correct: 1,
                explanation: "L'effet d'hyst√©r√®se d√©signe le ph√©nom√®ne par lequel un choc n√©gatif (comme une r√©cession) a des effets permanents sur l'√©conomie. Quand le PIB reste durablement √©loign√© de son niveau potentiel, cela peut entra√Æner une perte de comp√©tences des ch√¥meurs, une d√©pr√©ciation du capital humain et un sous-investissement, r√©duisant √† terme le PIB potentiel lui-m√™me. C'est pour cette raison que l'on cherche √† r√©sorber au plus vite l'√©cart de production."
            },
            {
                chapter: 1,
                type: "concept",
                question: "Le PIB potentiel peut √™tre mesur√© directement.",
                answers: ["Vrai", "Faux"],
                correct: 1,
                explanation: "Le PIB potentiel, la croissance potentielle et l'√©cart de production ne sont pas directement observables. Ils doivent √™tre estim√©s √† l'aide de mod√®les √©conomiques. Selon les m√©thodologies utilis√©es (FMI, Commission europ√©enne, OCDE...), les estimations peuvent diff√©rer significativement et faire l'objet de r√©visions importantes. Cette incertitude complique la conduite de la politique √©conomique, car les d√©cideurs ne savent pas pr√©cis√©ment o√π se situe l'√©conomie par rapport √† son potentiel."
            },
            {
                chapter: 1,
                type: "chiffre",
                question: "Quelle est la part de l'investissement dans le PIB de la France en 2024 ?",
                answers: ["Environ 15 %", "Environ 22 %", "Environ 30 %", "Environ 40 %"],
                correct: 1,
                explanation: `L'investissement repr√©sente environ 22 % du PIB fran√ßais.<br><br>
<strong>Rappel :</strong> PIB = Consommation + Investissement + (Exportations ‚àí Importations) + Variation des stocks<br><br>
<table style="width:100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em;">
<tr style="background: var(--primary-light);"><th style="padding: 8px; text-align: left;">Composante</th><th style="padding: 8px; text-align: right;">Mds ‚Ç¨</th><th style="padding: 8px; text-align: right;">% PIB</th></tr>
<tr><td style="padding: 6px; border-bottom: 1px solid var(--border);">Consommation (m√©nages + APU)</td><td style="padding: 6px; text-align: right; border-bottom: 1px solid var(--border);">2 301</td><td style="padding: 6px; text-align: right; border-bottom: 1px solid var(--border);">78,8 %</td></tr>
<tr><td style="padding: 6px; border-bottom: 1px solid var(--border);">Investissement (FBCF)</td><td style="padding: 6px; text-align: right; border-bottom: 1px solid var(--border);">645</td><td style="padding: 6px; text-align: right; border-bottom: 1px solid var(--border);"><strong>22,1 %</strong></td></tr>
<tr style="font-size: 0.85em; color: var(--text-light);"><td style="padding: 4px 6px;">   ‚Ä¢ Entreprises</td><td style="padding: 4px 6px; text-align: right;">344</td><td style="padding: 4px 6px; text-align: right;">11,8 %</td></tr>
<tr style="font-size: 0.85em; color: var(--text-light);"><td style="padding: 4px 6px;">   ‚Ä¢ M√©nages</td><td style="padding: 4px 6px; text-align: right;">138</td><td style="padding: 4px 6px; text-align: right;">4,7 %</td></tr>
<tr style="font-size: 0.85em; color: var(--text-light);"><td style="padding: 4px 6px; border-bottom: 1px solid var(--border);">   ‚Ä¢ Administrations publiques</td><td style="padding: 4px 6px; text-align: right; border-bottom: 1px solid var(--border);">127</td><td style="padding: 4px 6px; text-align: right; border-bottom: 1px solid var(--border);">4,4 %</td></tr>
<tr><td style="padding: 6px; border-bottom: 1px solid var(--border);">Exportations</td><td style="padding: 6px; text-align: right; border-bottom: 1px solid var(--border);">990</td><td style="padding: 6px; text-align: right; border-bottom: 1px solid var(--border);">33,9 %</td></tr>
<tr><td style="padding: 6px; border-bottom: 1px solid var(--border);">‚àí Importations</td><td style="padding: 6px; text-align: right; border-bottom: 1px solid var(--border);">999</td><td style="padding: 6px; text-align: right; border-bottom: 1px solid var(--border);">34,2 %</td></tr>
<tr><td style="padding: 6px; border-bottom: 1px solid var(--border);">Variation des stocks</td><td style="padding: 6px; text-align: right; border-bottom: 1px solid var(--border);">- 17</td><td style="padding: 6px; text-align: right; border-bottom: 1px solid var(--border);">- 0,6 %</td></tr>
<tr style="font-weight: bold; background: var(--bg);"><td style="padding: 8px;">PIB</td><td style="padding: 8px; text-align: right;">2 920</td><td style="padding: 8px; text-align: right;">100 %</td></tr>
</table>
<p style="margin-top: 10px; font-size: 0.85em; color: var(--text-light);">Source : Insee, comptes nationaux 2024</p>`
            },
            // ========================================
            // CHAPITRE 2 : POLITIQUE BUDG√âTAIRE
            // ========================================
            {
                chapter: 2,
                type: "concept",
                question: "Si l'√âtat vend une participation dans une entreprise publique, est-ce que cela r√©duit la dette publique au sens de Maastricht ?",
                answers: ["Oui", "Non"],
                correct: 0,
                explanation: "Oui, car la dette publique au sens de Maastricht est une dette brute : elle ne tient pas compte des actifs d√©tenus par les administrations publiques. Ainsi, une cession d'actifs (comme la vente de participations dans une entreprise publique) r√©duit la dette brute car elle g√©n√®re des recettes qui permettent de rembourser des emprunts. Toutefois, une telle op√©ration n'est financi√®rement avantageuse que si elle am√©liore le patrimoine net des administrations publiques, c'est-√†-dire si le prix de vente est sup√©rieur √† la valeur actualis√©e des revenus futurs que l'actif aurait g√©n√©r√©s."
            },
            {
                chapter: 2,
                type: "chiffre",
                question: "Quelle est l'ann√©e du dernier exc√©dent primaire (d√©ficit hors charge de la dette) enregistr√© par la France ?",
                answers: ["1995", "2001", "2007", "2019"],
                correct: 1,
                explanation: "Le dernier exc√©dent primaire de la France remonte √† 2001. Depuis, la France n'a jamais r√©ussi √† d√©gager un solde primaire positif. C'est une situation exceptionnelle parmi les grandes √©conomies : √† titre de comparaison, l'Italie a d√©gag√© des exc√©dents primaires presque chaque ann√©e entre 1995 et 2019, ce qui n'a pas suffi √† r√©duire son endettement en raison d'un effet ¬´ boule de neige ¬ª d√©favorable (taux d'int√©r√™t sup√©rieur √† la croissance)."
            },
            {
                chapter: 2,
                type: "chiffre",
                question: "Quelle part des d√©penses publiques fran√ßaises les d√©penses de retraite repr√©sentent-elles environ ?",
                answers: ["Environ 10 %", "Environ un quart", "Environ un tiers", "Environ la moiti√©"],
                correct: 1,
                explanation: "Les d√©penses du syst√®me de retraite s'√©l√®vent √† environ 407 milliards d'euros, soit 13,9 % du PIB. Elles repr√©sentent ainsi pr√®s d'un quart de l'ensemble des d√©penses publiques fran√ßaises (qui s'√©l√®vent √† environ 57 % du PIB). C'est un niveau significativement sup√©rieur √† la moyenne de la zone euro (environ 2,5 points de PIB de plus) et √† l'Allemagne (environ 3,8 points de PIB de plus). L'√¢ge de d√©part effectif plus bas en France explique une grande partie de cet √©cart, et dans une moindre mesure une pension moyenne plus √©lev√©e."
            },
            {
                chapter: 2,
                type: "chiffre",
                question: "Quel est l'ordre de grandeur des recettes publiques totales en France, en points de PIB ?",
                answers: ["Environ 35 %", "Environ 43 %", "Environ 52 %", "Environ 60 %"],
                correct: 2,
                explanation: "Les recettes publiques totales repr√©sentent environ 52 % du PIB en France. Attention √† ne pas confondre avec les pr√©l√®vements obligatoires (imp√¥ts + cotisations sociales), qui repr√©sentent environ 43 % du PIB. La diff√©rence (environ 9 points) correspond aux autres recettes publiques : revenus du patrimoine, ventes de biens et services, transferts re√ßus, etc."
            },
            {
                chapter: 2,
                type: "concept",
                question: "Un pays peut voir son ratio d'endettement public augmenter m√™me s'il d√©gage un exc√©dent primaire.",
                answers: ["Vrai", "Faux"],
                correct: 0,
                explanation: "C'est l'effet ¬´ boule de neige ¬ª : lorsque le taux d'int√©r√™t moyen pay√© sur la dette est sup√©rieur au taux de croissance nominal de l'√©conomie (r > g), l'endettement ¬´ augmente tout seul ¬ª m√™me avec un exc√©dent primaire. C'est ce qui s'est pass√© en Italie entre 1995 et 2017 : malgr√© des exc√©dents primaires presque chaque ann√©e, le ratio d'endettement n'a pas diminu√© en raison d'un diff√©rentiel int√©r√™t-croissance tr√®s d√©favorable."
            },
            {
                chapter: 2,
                type: "chiffre",
                question: "Quelle part de la dette publique fran√ßaise est d√©tenue par la Banque centrale (BCE et Banque de France) ?",
                answers: ["Environ 5 %", "Environ 20 %", "Environ 35 %", "Environ la moiti√©"],
                correct: 1,
                explanation: "La Banque centrale (via l'Eurosyst√®me) d√©tient environ 20 % de la dette publique fran√ßaise en 2024, suite aux programmes d'achats d'actifs (APP puis PEPP). Cette part √©tait quasi nulle au d√©but des ann√©es 2000, a fortement augment√© apr√®s la crise financi√®re de 2008 puis la crise sanitaire (jusqu'√† environ un tiers), avant de redescendre avec la fin des programmes d'achat. Cette d√©tention contribue √† r√©duire la charge d'int√©r√™ts car la BCE reverse ses b√©n√©fices aux √âtats membres."
            },
            {
                chapter: 2,
                type: "chiffre",
                question: "Quel est l'ordre de grandeur de l'effort d'√©conomies n√©cessaire pour que la France stabilise son ratio d'endettement ?",
                answers: ["Environ 30 milliards d'euros", "Environ 60 milliards d'euros", "Environ 110 milliards d'euros", "Environ 200 milliards d'euros"],
                correct: 2,
                explanation: "Pour stabiliser l'endettement fran√ßais, il faut atteindre l'√©quilibre primaire. En 2024, le d√©ficit primaire structurel √©tait d'environ 3,6 points de PIB. Le ramener √† z√©ro repr√©sente ainsi un effort d'√©conomies de l'ordre de 110 milliards d'euros. Le Conseil d'analyse √©conomique recommande m√™me d'aller au-del√† (vers un surplus primaire de 1 % du PIB) pour r√©duire l'endettement et retrouver des marges de man≈ìuvre avant la prochaine crise."
            },
            {
                chapter: 2,
                type: "chiffre",
                question: "Quel est l'ordre de grandeur du montant des baisses de pr√©l√®vements obligatoires d√©cid√©es en France entre 2018 et 2023 ?",
                answers: ["Environ 20 milliards d'euros", "Environ 40 milliards d'euros", "Environ 60 milliards d'euros", "Environ 100 milliards d'euros"],
                correct: 2,
                explanation: "Entre 2018 et 2023, les baisses de pr√©l√®vements obligatoires ont atteint environ 62 milliards d'euros selon la Cour des comptes, soit pr√®s de 2 points de PIB. Ces baisses (suppression de la taxe d'habitation, baisse des imp√¥ts de production, baisse du taux d'IS de 33 % √† 25 %, etc.) ont frein√© le redressement des comptes publics qui avait √©t√© amorc√© apr√®s la crise des dettes souveraines."
            },
            {
                chapter: 2,
                type: "definition",
                question: "Que d√©signe la ¬´ r√®gle des 3T ¬ª en mati√®re de politique budg√©taire ?",
                answers: ["Taxation, Transferts, Tr√©sorerie", "Timely, Targeted, Temporary", "Timing, Transmission, Trajectory", "Transitory, Transparent, Transformative"],
                correct: 1,
                explanation: "La r√®gle des 3T (timely, targeted, temporary) d√©finit les crit√®res d'un bon plan de relance budg√©taire : il doit √™tre mis en ≈ìuvre au bon moment (timely), √™tre cibl√© sur les mesures les plus efficaces pour soutenir l'activit√© (targeted) et √™tre temporaire pour ne pas d√©grader durablement les finances publiques (temporary). Le plan de relance fran√ßais post-Covid a notamment √©t√© critiqu√© pour ne pas respecter le crit√®re ¬´ temporaire ¬ª, certaines mesures (comme la baisse des imp√¥ts de production) √©tant p√©rennes."
            },
            {
                chapter: 2,
                type: "chiffre",
                question: "De combien le ratio de d√©ficit public (en points de PIB) s'am√©liore-t-il si la croissance est plus √©lev√©e de 1 point en France ?",
                answers: ["0,2 point de PIB", "0,6 point de PIB", "1 point de PIB", "1,5 point de PIB"],
                correct: 1,
                explanation: "La semi-√©lasticit√© budg√©taire de la France est d'environ 0,6. Cela signifie qu'une hausse de 1 point du PIB am√©liore le solde public de 0,6 point de PIB. Cette am√©lioration provient principalement du fait que les recettes fiscales augmentent avec l'activit√© (TVA, imp√¥t sur le revenu, cotisations...), alors que les d√©penses restent globalement assez stables. En sens inverse, une r√©cession d√©grade le d√©ficit de 0,6 point par point de PIB perdu."
            },
            {
                chapter: 2,
                type: "concept",
                question: "Le patrimoine net des administrations publiques fran√ßaises (actifs moins passifs) est n√©gatif.",
                answers: ["Vrai", "Faux"],
                correct: 1,
                explanation: "Le patrimoine net des administrations publiques fran√ßaises reste positif : il s'√©levait √† 633 milliards d'euros fin 2024, soit 21,7 % du PIB. La dette brute (au sens de Maastricht) d√©passe 3 200 milliards, mais les administrations publiques d√©tiennent aussi des actifs importants (immobilier, infrastructures, participations financi√®res). Toutefois, la plupart de ces actifs ne sont pas cessibles (routes, √©coles, h√¥pitaux...) et la valeur du patrimoine net s'est fortement d√©grad√©e : elle repr√©sentait encore 60 % du PIB en 2007, avant la crise financi√®re."
            },
            {
                chapter: 2,
                type: "definition",
                question: "Le multiplicateur budg√©taire mesure l'impact sur le PIB d'un effort d'√©conomies (ou d'une relance) de 1 point de PIB.",
                answers: ["Vrai", "Faux"],
                correct: 0,
                explanation: "Le multiplicateur budg√©taire repr√©sente la variation du PIB engendr√©e √† court terme par un effort d'√©conomies (ou une impulsion budg√©taire) de 1 point de PIB. Il est g√©n√©ralement compris entre 0,5 et 1,5, avec une valeur de r√©f√©rence de 0,75 retenue par la Commission europ√©enne. Le multiplicateur est plus √©lev√© en bas de cycle √©conomique (quand l'√©conomie sous-utilise ses capacit√©s) et pour les d√©penses publiques (par rapport aux recettes)."
            },
            {
                chapter: 2,
                type: "definition",
                question: "Le d√©ficit structurel correspond au d√©ficit public hors charge de la dette.",
                answers: ["Vrai", "Faux"],
                correct: 1,
                explanation: "<strong>Attention √† ne pas confondre d√©ficit primaire et d√©ficit structurel !</strong><br><br><strong>Le d√©ficit primaire</strong> est le d√©ficit public hors charge de la dette (c'est-√†-dire hors paiement des int√©r√™ts). Il permet d'isoler la situation budg√©taire courante, ind√©pendamment du poids du pass√© (les int√©r√™ts de la dette).<br><br><strong>Le d√©ficit structurel</strong> est le d√©ficit public corrig√© des effets du cycle √©conomique et des mesures ponctuelles et temporaires (comme l‚Äôimpact d‚Äôun contentieux fiscal exceptionnel). C'est un indicateur pertinent pour appr√©cier la soutenabilit√© de la politique budg√©taire, car il neutralise les fluctuations conjoncturelles des recettes et d√©penses."
            },
            {
                chapter: 2,
                type: "chiffre",
                question: "Quelle est la dur√©e de vie moyenne de la dette publique fran√ßaise ?",
                answers: ["Environ 5 ans", "Environ 8 ans", "Environ 12 ans", "Environ 16 ans"],
                correct: 1,
                explanation: "La dur√©e de vie moyenne de la dette publique fran√ßaise est d'environ 8 ans fin 2025. Cette maturit√© relativement longue explique pourquoi une hausse des taux d'int√©r√™t met du temps √† se transmettre √† la charge de la dette : seule la part de la dette qui arrive √† √©ch√©ance chaque ann√©e doit √™tre refinanc√©e aux nouveaux taux. Ainsi, m√™me si les taux √† l'√©mission ont fortement augment√© depuis 2022, le taux moyen pay√© sur l'ensemble de la dette n'augmente que progressivement."
            },
            {
                chapter: 2,
                type: "chiffre",
                question: "Quel est l'ordre de grandeur du taux d'int√©r√™t moyen sur la dette fran√ßaise √©mise en 2025 ?",
                answers: ["Environ 1 %", "Environ 3 %", "Environ 5 %", "Environ 7 %"],
                correct: 1,
                explanation: "Le taux d'int√©r√™t moyen sur la dette fran√ßaise √©mise en 2025 est d'environ 3,1 %. C'est une hausse consid√©rable par rapport au point bas atteint pendant la crise sanitaire, o√π ce taux √©tait proche de 0 % (voire n√©gatif pour certaines √©missions). Cette remont√©e des taux, li√©e au resserrement mon√©taire de la BCE face √† l'inflation, p√®sera progressivement sur la charge de la dette √† mesure que les anciennes √©missions √† taux bas arrivent √† √©ch√©ance."
            }
        ];

        // Exercices chiffr√©s - Format: { chapter, question, answer, unit, tolerance, explanation, alt }
        // alt = version alternative avec des valeurs diff√©rentes pour r√©essayer
        const exercices = [
            {
                chapter: 1,
                question: "Si le PIB potentiel est de 2 850 milliards d'euros et le PIB effectif de 2 800 milliards d'euros, quel est l'√©cart de production ?",
                answer: -1.8,
                unit: "%",
                tolerance: 0.3,
                explanation: "√âcart de production = (PIB effectif - PIB potentiel) / PIB potentiel √ó 100 = (2 800 - 2 850) / 2 850 √ó 100 = -1,75 %, soit environ -1,8 %. Un √©cart n√©gatif signifie que l'√©conomie produit en dessous de son potentiel.",
                alt: {
                    question: "Si le PIB potentiel est de 3 000 milliards d'euros et le PIB effectif de 3 120 milliards d'euros, quel est l'√©cart de production ?",
                    answer: 4,
                    explanation: "√âcart de production = (PIB effectif - PIB potentiel) / PIB potentiel √ó 100 = (3 120 - 3 000) / 3 000 √ó 100 = 4 %. Un √©cart positif signifie que l'√©conomie produit au-dessus de son potentiel (surchauffe)."
                }
            },
            {
                chapter: 1,
                question: "Si la croissance du PIB est de 2 % et que les contributions respectives du travail et du capital sont de 0,5 % et 0,7 %, quelle est la contribution de la productivit√© globale des facteurs (PGF) ?",
                answer: 0.8,
                unit: "%",
                tolerance: 0.1,
                explanation: "La d√©composition comptable de la croissance s'√©crit : g(PIB) = contribution du travail + contribution du capital + PGF. Donc PGF = 2 % - 0,5 % - 0,7 % = 0,8 %. La PGF repr√©sente la part ¬´ inexpliqu√©e ¬ª de la croissance, souvent assimil√©e au progr√®s technique.",
                alt: {
                    question: "Si la croissance du PIB est de 1,5 % et que les contributions respectives du travail et du capital sont de 0,3 % et 0,6 %, quelle est la contribution de la productivit√© globale des facteurs (PGF) ?",
                    answer: 0.6,
                    explanation: "La d√©composition comptable de la croissance s'√©crit : g(PIB) = contribution du travail + contribution du capital + PGF. Donc PGF = 1,5 % - 0,3 % - 0,6 % = 0,6 %."
                }
            },
            {
                chapter: 1,
                question: "Si la croissance du PIB en valeur (nominale) est de 3,5 % et l'inflation de 2,3 %, quel est le taux de croissance du PIB en volume (r√©el) ?",
                answer: 1.2,
                unit: "%",
                tolerance: 0.2,
                explanation: "Croissance r√©elle = croissance nominale - inflation = 3,5 % - 2,3 % = 1,2 %. Le PIB en volume (r√©el) mesure l'√©volution des quantit√©s produites, corrig√©e de l'√©volution des prix.",
                alt: {
                    question: "Si la croissance du PIB en valeur (nominale) est de 4,2 % et l'inflation de 2,8 %, quel est le taux de croissance du PIB en volume (r√©el) ?",
                    answer: 1.4,
                    explanation: "Croissance r√©elle = croissance nominale - inflation = 4,2 % - 2,8 % = 1,4 %."
                }
            },
            {
                chapter: 1,
                question: "Calculez le PIB par habitant de la France √† partir des donn√©es suivantes : part de la population en √¢ge de travailler = 60 %, taux d'emploi = 68 %, heures travaill√©es par employ√© = 1 500 h/an, productivit√© horaire = 70 ‚Ç¨/h.",
                answer: 42840,
                unit: "‚Ç¨",
                tolerance: 1000,
                explanation: "PIB/habitant = Part en √¢ge de travailler √ó Taux d'emploi √ó Heures par employ√© √ó Productivit√© horaire = 0,60 √ó 0,68 √ó 1 500 √ó 70 = 42 840 ‚Ç¨. Cette d√©composition montre les quatre leviers du PIB par habitant : la d√©mographie (part en √¢ge de travailler), le march√© du travail (taux d'emploi), le temps de travail (heures par employ√©) et l'efficacit√© productive (productivit√© horaire).",
                alt: {
                    question: "Calculez le PIB par habitant de l'Allemagne √† partir des donn√©es suivantes : part de la population en √¢ge de travailler = 64 %, taux d'emploi = 77 %, heures travaill√©es par employ√© = 1 340 h/an, productivit√© horaire = 72 ‚Ç¨/h.",
                    answer: 47552,
                    explanation: "PIB/habitant = 0,64 √ó 0,77 √ó 1 340 √ó 72 = 47 552 ‚Ç¨. L'Allemagne a un taux d'emploi plus √©lev√© que la France mais moins d'heures travaill√©es par employ√©."
                }
            },
            {
                chapter: 1,
                question: "L'√©cart de production est initialement de -2 %. La croissance potentielle est de 1 % et la croissance effective de 2 %. Quel sera l'√©cart de production √† l'issue de l'exercice ?",
                answer: -1,
                unit: "%",
                tolerance: 0.3,
                explanation: "L'√©cart de production √©volue chaque ann√©e de (croissance effective - croissance potentielle). Ici : 2 % - 1 % = +1 point. L'√©cart passe donc de - 2 % √† - 1 %. L'√©conomie se rapproche de son potentiel.",
                alt: {
                    question: "L'√©cart de production est initialement de + 3 %. La croissance potentielle est de 1,5 % et la croissance effective de 1 %. Quel sera l'√©cart de production √† l'issue de l'exercice ?",
                    answer: 2.5,
                    explanation: "L'√©cart de production √©volue chaque ann√©e de (croissance effective - croissance potentielle). Ici : 1 % - 1,5 % = - 0,5 point. L'√©cart passe donc de + 3 % √† + 2,5 %. L'√©conomie se rapproche de son potentiel."
                }
            },
            // ========================================
            // CHAPITRE 2 : POLITIQUE BUDG√âTAIRE
            // ========================================
            {
                chapter: 2,
                question: `Un pays a un d√©ficit public initial de 5 % du PIB. Le gouvernement d√©cide d'un plan d'√©conomies de 2 points de PIB. Si le multiplicateur budg√©taire est de 0,8 et la semi-√©lasticit√© budg√©taire de 0,6, quel sera le d√©ficit public un an apr√®s le plan d'√©conomies ?`,
                answer: 4,
                unit: "% du PIB",
                tolerance: 0.2,
                explanation: `<strong>Calcul en deux √©tapes :</strong><br><br>
<strong>1. Effet r√©cessif du plan d'√©conomies :</strong><br>
Le plan d'√©conomies de 2 points de PIB r√©duit le PIB de : 2 √ó 0,8 (multiplicateur) = 1,6 %<br><br>
<strong>2. Impact sur le d√©ficit :</strong><br>
‚Ä¢ Am√©lioration directe (√©conomies) : - 2 points de PIB<br>
‚Ä¢ D√©gradation indirecte (effet r√©cessif) : 1,6 % √ó 0,6 (semi-√©lasticit√©) = + 0,96 point de PIB<br><br>
<strong>Am√©lioration nette du d√©ficit :</strong> 2 - 0,96 ‚âà 1 point de PIB<br><br>
<strong>D√©ficit final :</strong> 5 % - 1 % = <strong>4 % du PIB</strong><br><br>
Ainsi, pour un effort de 2 points, on ne r√©duit le d√©ficit que d'environ 1 point la premi√®re ann√©e : la moiti√© de l'effort ¬´ s'√©vapore ¬ª du fait de l'effet r√©cessif de la consolidation budg√©taire. Toutefois, l'effet multiplicateur s'estompe progressivement (il dispara√Æt g√©n√©ralement √† horizon de 5 ans), si bien que l'am√©lioration du d√©ficit se rapproche ensuite des 2 points d'effort initial.`,
                alt: {
                    question: `Un pays a un d√©ficit public initial de 6 % du PIB. Le gouvernement d√©cide d'un plan d'√©conomies de 1,5 point de PIB. Si le multiplicateur budg√©taire est de 0,75 et la semi-√©lasticit√© budg√©taire de 0,6, quel sera le d√©ficit public apr√®s le plan d'√©conomies ?`,
                    answer: 5.3,
                    explanation: `<strong>Calcul en deux √©tapes :</strong><br><br>
<strong>1. Effet r√©cessif du plan d'√©conomies :</strong><br>
Le plan d'√©conomies de 1,5 point de PIB r√©duit le PIB de : 1,5 √ó 0,75 = 1,125 %<br><br>
<strong>2. Impact sur le d√©ficit :</strong><br>
‚Ä¢ Am√©lioration directe : - 1,5 point de PIB<br>
‚Ä¢ D√©gradation indirecte : 1,125 % √ó 0,6 = + 0,675 point de PIB<br><br>
<strong>Am√©lioration nette :</strong> 1,5 - 0,675 ‚âà 0,83 point de PIB<br><br>
<strong>D√©ficit final :</strong> 6 % - 0,83 % ‚âà <strong>5,2 √† 5,3 % du PIB</strong>`
                }
            },
            {
                chapter: 2,
                question: `Un pays a un taux d'endettement initial de 110 % du PIB. La croissance nominale (croissance r√©elle + inflation) est de 3 % et le taux d'int√©r√™t moyen pay√© sur la dette est de 4 %. Le solde primaire est √† l'√©quilibre (0 %). Quel sera le taux d'endettement l'ann√©e suivante ?`,
                answer: 111.1,
                unit: "% du PIB",
                tolerance: 0.5,
                explanation: `<strong>√âquation simplifi√©e de la dynamique de l'endettement :</strong><br><br>
Œîd = d √ó (r - g) - s<br><br>
o√π d = endettement initial, r = taux d'int√©r√™t, g = croissance nominale, s = solde primaire<br><br>
<strong>Application num√©rique :</strong><br>
Œîd = 110 % √ó (4 % - 3 %) - 0 %<br>
Œîd = 110 % √ó 1 % = <strong>1,1 point de PIB</strong><br><br>
<strong>Endettement final :</strong> 110 % + 1,1 % = <strong>111,1 % du PIB</strong><br><br>
C'est l'effet ¬´ boule de neige ¬ª : m√™me avec un solde primaire √† l'√©quilibre, l'endettement augmente car le taux d'int√©r√™t (4 %) est sup√©rieur √† la croissance nominale (3 %). L'√©cart de 1 point, appliqu√© √† une dette de 110 % du PIB, g√©n√®re m√©caniquement une hausse de l'endettement de 1,1 point.`,
                alt: {
                    question: `Un pays a un taux d'endettement initial de 150 % du PIB. La croissance nominale est de 2 % et le taux d'int√©r√™t moyen pay√© sur la dette est de 3,5 %. Le solde primaire est exc√©dentaire de 1 % du PIB. Quel sera le taux d'endettement l'ann√©e suivante ?`,
                    answer: 151.3,
                    explanation: `<strong>√âquation :</strong> Œîd = d √ó (r - g) - s<br><br>
<strong>Application :</strong><br>
Œîd = 150 % √ó (3,5 % - 2 %) - 1 %<br>
Œîd = 150 % √ó 1,5 % - 1 %<br>
Œîd = 2,25 % - 1 % = <strong>1,25 point de PIB</strong><br><br>
<strong>Endettement final :</strong> 150 % + 1,25 % ‚âà <strong>151,3 % du PIB</strong><br><br>
Malgr√© un exc√©dent primaire de 1 %, l'endettement augmente car l'effet boule de neige (2,25 points) est sup√©rieur √† l'effort budg√©taire (1 point). C'est la situation de l'Italie pendant de nombreuses ann√©es.`
                }
            },
            {
                chapter: 2,
                question: `Un pays souhaite stabiliser son ratio d'endettement √† 112 % du PIB. Le taux d'int√©r√™t moyen sur la dette est de 3,3 % et la croissance nominale de 3 %. Quel solde primaire (en points de PIB) doit-il d√©gager pour y parvenir ?`,
                answer: 0.3,
                unit: "% du PIB",
                tolerance: 0.2,
                explanation: `<strong>Solde primaire stabilisant :</strong><br><br>
Pour que l'endettement reste stable (Œîd = 0), il faut que :<br>
s* = d √ó (r - g)<br><br>
<strong>Application num√©rique :</strong><br>
s* = 112 % √ó (3,3 % - 3 %)<br>
s* = 112 % √ó 0,3 %<br>
s* = <strong>0,34 % du PIB</strong>, soit environ <strong>0,3 % du PIB</strong><br><br>
Avec ces param√®tres proches de la situation fran√ßaise actuelle (r ‚âà g), un l√©ger exc√©dent primaire suffirait √† stabiliser l'endettement. Toutefois, la France affiche actuellement un d√©ficit primaire de l'ordre de 3 √† 4 points de PIB, ce qui explique la hausse continue du ratio d'endettement.`,
                alt: {
                    question: `Un pays souhaite stabiliser son ratio d'endettement √† 130 % du PIB. Le taux d'int√©r√™t moyen sur la dette est de 4 % et la croissance nominale de 2,5 %. Quel solde primaire (en points de PIB) doit-il d√©gager pour y parvenir ?`,
                    answer: 2,
                    explanation: `<strong>Solde primaire stabilisant :</strong> s* = d √ó (r - g)<br><br>
<strong>Application :</strong><br>
s* = 130 % √ó (4 % - 2,5 %)<br>
s* = 130 % √ó 1,5 %<br>
s* = <strong>1,95 % du PIB</strong>, soit environ <strong>2 % du PIB</strong><br><br>
Avec un diff√©rentiel int√©r√™t-croissance de 1,5 point et un endettement de 130 % du PIB, l'effort budg√©taire requis devient substantiel. C'est le d√©fi auquel font face des pays comme l'Italie, o√π l'effet boule de neige impose de d√©gager des exc√©dents primaires importants uniquement pour stabiliser la dette.`
                }
            },
            {
                chapter: 2,
                question: `Le d√©ficit public de la France est de 5,5 % du PIB et l'√©cart de production est estim√© √† - 1,5 %. Si la semi-√©lasticit√© budg√©taire est de 0,6, quel est le d√©ficit structurel ?`,
                answer: 4.6,
                unit: "% du PIB",
                tolerance: 0.2,
                explanation: `<strong>Formule du d√©ficit structurel :</strong><br><br>
D√©ficit structurel = D√©ficit public + semi-√©lasticit√© √ó √©cart de production<br><br>
<strong>Application num√©rique :</strong><br>
D√©ficit structurel = 5,5 % + 0,6 √ó (- 1,5 %)<br>
D√©ficit structurel = 5,5 % - 0,9 %<br>
D√©ficit structurel = <strong>4,6 % du PIB</strong><br><br>
<strong>Interpr√©tation :</strong> L'√©cart de production n√©gatif (√©conomie en sous-r√©gime) d√©grade automatiquement le d√©ficit public de 0,9 point de PIB (composante conjoncturelle). Une fois cette composante retir√©e, le d√©ficit structurel ‚Äì qui refl√®te l'orientation de la politique budg√©taire ‚Äì est de 4,6 % du PIB.`,
                alt: {
                    question: `Le d√©ficit public d'un pays est de 3 % du PIB et l'√©cart de production est estim√© √† + 2 %. Si la semi-√©lasticit√© budg√©taire est de 0,5, quel est le d√©ficit structurel ?`,
                    answer: 4,
                    explanation: `<strong>Formule :</strong> D√©ficit structurel = D√©ficit public + semi-√©lasticit√© √ó √©cart de production<br><br>
<strong>Application :</strong><br>
D√©ficit structurel = 3 % + 0,5 √ó (+ 2 %)<br>
D√©ficit structurel = 3 % + 1 %<br>
D√©ficit structurel = <strong>4 % du PIB</strong><br><br>
<strong>Interpr√©tation :</strong> L'√©cart de production positif (√©conomie en surchauffe) am√©liore artificiellement le d√©ficit public de 1 point de PIB. Le d√©ficit structurel (4 %) est donc plus d√©grad√© que le d√©ficit apparent (3 %) : la bonne conjoncture masque une situation budg√©taire sous-jacente plus fragile.`
                }
            }
        ];

        // Simulations - Les simulations sont g√©r√©es de mani√®re sp√©ciale avec des graphiques
        const simulations = [
            {
                chapter: 1,
                title: "√âvolution de l'√©cart de production",
                description: "Observez comment le PIB effectif converge vers le PIB potentiel (ou s'en √©loigne) selon les taux de croissance.",
                type: "output_gap_graph"
            },
            {
                chapter: 2,
                title: "Dynamique de l'endettement public",
                description: "Explorez comment le ratio dette/PIB √©volue selon la croissance, l'inflation, les taux d'int√©r√™t et le solde primaire. Comprenez l'effet ¬´ boule de neige ¬ª en action.",
                type: "debt_dynamics_graph"
            }
        ];

        // ===========================================
        // LOGIQUE DU QUIZ
        // ===========================================

        let selectedChapters = [];
        let currentMode = null;
        let currentQuestions = [];
        let currentIndex = 0;
        let score = 0;
        let usingAltVersion = false;

        // Initialisation
        function init() {
            renderChapters();
            setupEventListeners();
        }

        function renderChapters() {
            const container = document.getElementById('chapters-list');
            container.innerHTML = chapters.map(ch => `
                <label class="chapter-checkbox ${ch.available ? '' : 'disabled'}" data-id="${ch.id}">
                    <input type="checkbox" ${ch.available ? '' : 'disabled'} onchange="toggleChapter(${ch.id})">
                    <span>${ch.name}</span>
                </label>
            `).join('');
        }

        function toggleChapter(id) {
            const index = selectedChapters.indexOf(id);
            if (index === -1) {
                selectedChapters.push(id);
            } else {
                selectedChapters.splice(index, 1);
            }

            // Update visual
            document.querySelectorAll('.chapter-checkbox').forEach(el => {
                const chId = parseInt(el.dataset.id);
                el.classList.toggle('selected', selectedChapters.includes(chId));
            });

            // Enable/disable buttons
            const hasSelection = selectedChapters.length > 0;
            document.getElementById('btn-qcm').disabled = !hasSelection;
            document.getElementById('btn-exercice').disabled = !hasSelection;
            document.getElementById('btn-simulation').disabled = !hasSelection;
        }

        function setupEventListeners() {
            document.getElementById('btn-qcm').onclick = () => startMode('qcm');
            document.getElementById('btn-exercice').onclick = () => startMode('exercice');
            document.getElementById('btn-simulation').onclick = () => startMode('simulation');
        }

        function startMode(mode) {
            currentMode = mode;
            currentIndex = 0;
            score = 0;

            // Filter questions by selected chapters
            if (mode === 'qcm') {
                currentQuestions = qcmQuestions.filter(q => selectedChapters.includes(q.chapter));
                shuffleArray(currentQuestions);
            } else if (mode === 'exercice') {
                currentQuestions = exercices.filter(e => selectedChapters.includes(e.chapter));
                shuffleArray(currentQuestions);
            } else if (mode === 'simulation') {
                currentQuestions = simulations.filter(s => selectedChapters.includes(s.chapter));
            }

            if (currentQuestions.length === 0) {
                alert('Aucun contenu disponible pour les chapitres s√©lectionn√©s.');
                return;
            }

            document.getElementById('menu').style.display = 'none';
            document.getElementById('quiz').style.display = 'block';

            // Adapter l'en-t√™te selon le mode
            const quizInfo = document.querySelector('.quiz-info');
            if (mode === 'simulation') {
                quizInfo.innerHTML = `<span>Simulation <span id="current-q">1</span>/<span id="total-q">${currentQuestions.length}</span></span>`;
            } else {
                quizInfo.innerHTML = `
                    <span>Question <span id="current-q">1</span>/<span id="total-q">${currentQuestions.length}</span></span>
                    <span class="score">Score : <span id="score">0</span></span>
                `;
            }

            updateProgress();
            renderQuestion();
        }

        function renderQuestion() {
            const container = document.getElementById('question-container');

            if (currentIndex >= currentQuestions.length) {
                showResults();
                return;
            }

            const item = currentQuestions[currentIndex];
            const chapter = chapters.find(c => c.id === item.chapter);

            if (currentMode === 'qcm') {
                container.innerHTML = `
                    <div class="question-card">
                        <div class="question-meta">
                            <span class="badge badge-chapter">${chapter.name}</span>
                            <span class="badge badge-type">${getTypeLabel(item.type)}</span>
                        </div>
                        <p class="question-text">${item.question}</p>
                        <div class="answers">
                            ${item.answers.map((a, i) => `
                                <button class="answer-btn" onclick="checkAnswer(${i})">${a}</button>
                            `).join('')}
                        </div>
                        <div class="explanation" id="explanation">
                            <h4>Explication</h4>
                            <p>${item.explanation}</p>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn-next show" id="btn-skip" onclick="nextQuestion()" style="background: var(--text-light);">Passer</button>
                            <button class="btn-next" id="btn-next" onclick="nextQuestion()">Question suivante</button>
                        </div>
                    </div>
                `;
            } else if (currentMode === 'exercice') {
                const currentItem = usingAltVersion && item.alt ? item.alt : item;
                const questionText = currentItem.question;
                const explanationText = currentItem.explanation;

                container.innerHTML = `
                    <div class="question-card">
                        <div class="question-meta">
                            <span class="badge badge-chapter">${chapter.name}</span>
                            <span class="badge badge-type">Exercice chiffr√©</span>
                        </div>
                        <p class="question-text">${questionText}</p>
                        <div class="exercise-input">
                            <input type="number" id="exercise-answer" step="any" placeholder="Votre r√©ponse" onkeydown="if(event.key === 'Enter') checkExercise()">
                            <span class="unit">${item.unit}</span>
                            <button class="btn-validate" onclick="checkExercise()">Valider</button>
                        </div>
                        <div class="explanation" id="explanation">
                            <h4>Explication</h4>
                            <p>${explanationText}</p>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button class="btn-next show" id="btn-skip" onclick="nextQuestion()" style="background: var(--text-light);">Passer</button>
                            <div class="exercise-buttons" id="exercise-buttons" style="display: none; gap: 10px;">
                                <button class="btn-next show" id="btn-retry" onclick="retryExercise()" style="display: none; background: var(--info);">R√©essayer</button>
                                <button class="btn-next show" id="btn-next" onclick="nextQuestion()">Exercice suivant</button>
                            </div>
                        </div>
                    </div>
                `;
                // Ne pas focus sur mobile pour √©viter l'ouverture du clavier
                if (window.innerWidth > 600) {
                    document.getElementById('exercise-answer').focus();
                }
            } else if (currentMode === 'simulation') {
                if (item.type === 'output_gap_graph') {
                    container.innerHTML = `
                        <div class="question-card">
                            <div class="question-meta">
                                <span class="badge badge-chapter">${chapter.name}</span>
                                <span class="badge badge-type">Simulation interactive</span>
                            </div>
                            <h3 style="margin-bottom: 15px;">${item.title}</h3>
                            <p class="question-text">${item.description}</p>
                            <div class="simulation-container">
                                <div class="simulation-controls">
                                    <div class="control-group">
                                        <label>√âcart de production initial (% du PIB potentiel)</label>
                                        <input type="range" id="initial_gap" min="-5" max="5" value="0" step="0.5" oninput="updateOutputGapGraph()">
                                        <div class="value" id="initial_gap-value">0 %</div>
                                    </div>
                                    <div class="control-group">
                                        <label>Croissance potentielle (% par an)</label>
                                        <input type="range" id="g_potential" min="0.5" max="3" value="1.2" step="0.1" oninput="updateOutputGapGraph()">
                                        <div class="value" id="g_potential-value">1,2 %</div>
                                    </div>
                                    <div class="control-group">
                                        <label>Croissance effective (% par an)</label>
                                        <input type="range" id="g_effective" min="-1" max="4" value="1.5" step="0.1" oninput="updateOutputGapGraph()">
                                        <div class="value" id="g_effective-value">1,5 %</div>
                                    </div>
                                </div>
                                <div class="graph-container">
                                    <canvas id="outputGapCanvas" width="800" height="350"></canvas>
                                </div>
                                <div class="simulation-results-row">
                                    <div class="simulation-result-item">
                                        <div class="label">√âcart de production initial</div>
                                        <div class="value" id="result-initial-gap">0 %</div>
                                        <div id="gap-status-initial" style="text-align: center; padding: 8px; border-radius: 8px; margin-top: 8px; font-weight: 600; font-size: 0.85em;"></div>
                                    </div>
                                    <div class="simulation-result-item">
                                        <div class="label">√âcart de production apr√®s 5 ans</div>
                                        <div class="value" id="result-final-gap">-</div>
                                        <div id="gap-status-final" style="text-align: center; padding: 8px; border-radius: 8px; margin-top: 8px; font-weight: 600; font-size: 0.85em;"></div>
                                    </div>
                                </div>
                                <button id="btn-close-gap" class="btn-validate" onclick="closeGapIn5Years()" style="margin-bottom: 15px; width: 100%;">Fermer l'√©cart de production initial en n+5</button>
                                <div class="simulation-explanation" id="simulation-explanation">
                                    <strong>Comment lire ce graphique :</strong> La courbe bleue repr√©sente le PIB effectif, la courbe rouge pointill√©e le PIB potentiel.
                                    Quand la croissance effective d√©passe la croissance potentielle, l'√©cart de production se r√©duit progressivement.
                                    Si la croissance effective est inf√©rieure √† la croissance potentielle, l'√©cart se creuse.
                                </div>
                            </div>
                            <button class="btn-next show" onclick="backToMenu()">Retour au menu</button>
                        </div>
                    `;
                    updateOutputGapGraph();
                } else if (item.type === 'debt_dynamics_graph') {
                    container.innerHTML = `
                        <div class="question-card">
                            <div class="question-meta">
                                <span class="badge badge-chapter">${chapter.name}</span>
                                <span class="badge badge-type">Simulation interactive</span>
                            </div>
                            <h3 style="margin-bottom: 15px;">${item.title}</h3>
                            <p class="question-text">${item.description}</p>
                            <div class="simulation-container">
                                <div class="simulation-controls">
                                    <div class="control-group">
                                        <label>Endettement initial (% du PIB)</label>
                                        <input type="range" id="debt_initial" min="60" max="200" value="112" step="5" oninput="updateDebtDynamicsGraph()">
                                        <div class="value" id="debt_initial-value">112 %</div>
                                    </div>
                                    <div class="control-group">
                                        <label>Croissance r√©elle (% par an)</label>
                                        <input type="range" id="g_real" min="-1" max="4" value="1" step="0.1" oninput="updateDebtDynamicsGraph()">
                                        <div class="value" id="g_real-value">1 %</div>
                                    </div>
                                    <div class="control-group">
                                        <label>Inflation (% par an)</label>
                                        <input type="range" id="inflation" min="0" max="6" value="2" step="0.1" oninput="updateDebtDynamicsGraph()">
                                        <div class="value" id="inflation-value">2 %</div>
                                    </div>
                                    <div class="control-group">
                                        <label>Taux d'int√©r√™t moyen sur la dette (% par an)</label>
                                        <input type="range" id="r_interest" min="1" max="7" value="3" step="0.1" oninput="updateDebtDynamicsGraph()">
                                        <div class="value" id="r_interest-value">3 %</div>
                                    </div>
                                    <div class="control-group">
                                        <label>Solde primaire (% du PIB) <span style="font-size: 0.85em; color: var(--text-light);">positif = exc√©dent</span></label>
                                        <input type="range" id="primary_balance" min="-5" max="3" value="0" step="0.1" oninput="updateDebtDynamicsGraph()">
                                        <div class="value" id="primary_balance-value">0 %</div>
                                    </div>
                                </div>
                                <div class="graph-container">
                                    <canvas id="debtDynamicsCanvas" width="800" height="400"></canvas>
                                </div>
                                <div class="simulation-results-row">
                                    <div class="simulation-result-item">
                                        <div class="label">Croissance nominale (g)</div>
                                        <div class="value" id="result-g-nominal">3 %</div>
                                    </div>
                                    <div class="simulation-result-item">
                                        <div class="label">Diff√©rentiel r - g</div>
                                        <div class="value" id="result-r-minus-g">0 %</div>
                                        <div id="snowball-status" style="text-align: center; padding: 8px; border-radius: 8px; margin-top: 8px; font-weight: 600; font-size: 0.85em;"></div>
                                    </div>
                                    <div class="simulation-result-item">
                                        <div class="label">Endettement en n+10</div>
                                        <div class="value" id="result-debt-final">-</div>
                                        <div id="debt-trend" style="text-align: center; padding: 8px; border-radius: 8px; margin-top: 8px; font-weight: 600; font-size: 0.85em;"></div>
                                    </div>
                                </div>
                                <button id="btn-stabilize-debt" class="btn-validate" onclick="stabilizeDebt()" style="margin-bottom: 15px; width: 100%;">Calculer le solde primaire stabilisant</button>
                                <div class="simulation-explanation" id="debt-simulation-explanation">
                                    <strong>√âquation simplifi√©e :</strong> Œîd = d √ó (r - g) - s<br><br>
                                    o√π d = dette/PIB, r = taux d'int√©r√™t moyen, g = croissance nominale (r√©elle + inflation), s = solde primaire.<br><br>
                                    <strong>Effet ¬´ boule de neige ¬ª :</strong> Si r > g (diff√©rentiel positif), la dette ¬´ augmente toute seule ¬ª m√™me avec un solde primaire √©quilibr√©. Plus la dette initiale est √©lev√©e, plus cet effet est important.
                                </div>
                            </div>
                            <button class="btn-next show" onclick="backToMenu()">Retour au menu</button>
                        </div>
                    `;
                    updateDebtDynamicsGraph();
                }
            }
        }

        function getTypeLabel(type) {
            const labels = {
                'concept': 'Comprendre un concept',
                'chiffre': 'Ordre de grandeur',
                'definition': 'D√©finition'
            };
            return labels[type] || type;
        }

        function checkAnswer(index) {
            const item = currentQuestions[currentIndex];
            const buttons = document.querySelectorAll('.answer-btn');

            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === item.correct) {
                    btn.classList.add('correct');
                } else if (i === index && index !== item.correct) {
                    btn.classList.add('incorrect');
                }
            });

            const explanationDiv = document.getElementById('explanation');
            if (index === item.correct) {
                score++;
                document.getElementById('score').textContent = score;
                explanationDiv.innerHTML = `
                    <h4 style="color: var(--success);">‚úì Bonne r√©ponse</h4>
                    <p>${item.explanation}</p>
                `;
            } else {
                explanationDiv.innerHTML = `
                    <h4 style="color: var(--error);">‚úó Mauvaise r√©ponse</h4>
                    <p>${item.explanation}</p>
                `;
            }

            explanationDiv.classList.add('show');
            document.getElementById('btn-skip').style.display = 'none';
            document.getElementById('btn-next').classList.add('show');
        }

        function checkExercise() {
            const item = currentQuestions[currentIndex];
            const currentItem = usingAltVersion && item.alt ? item.alt : item;
            const input = document.getElementById('exercise-answer');
            // Accepter virgule ou point comme s√©parateur d√©cimal
            const userAnswer = parseFloat(input.value.replace(',', '.'));

            if (isNaN(userAnswer)) {
                alert('Veuillez entrer un nombre valide.');
                return;
            }

            const correctAnswer = currentItem.answer;
            const isCorrect = Math.abs(userAnswer - correctAnswer) <= item.tolerance;

            input.disabled = true;
            document.querySelector('.btn-validate').disabled = true;
            input.style.borderColor = isCorrect ? 'var(--success)' : 'var(--error)';
            input.style.background = isCorrect ? 'var(--success-bg)' : 'var(--error-bg)';

            const explanationDiv = document.getElementById('explanation');
            if (isCorrect) {
                score++;
                document.getElementById('score').textContent = score;
                explanationDiv.innerHTML = `
                    <h4 style="color: var(--success);">‚úì Bonne r√©ponse</h4>
                    <p>${currentItem.explanation}</p>
                `;
            } else {
                // D√©terminer le nombre de d√©cimales √† afficher
                const decimalPlaces = correctAnswer % 1 !== 0 ? 1 : 0;
                const formattedAnswer = formatNumber(correctAnswer, decimalPlaces);
                explanationDiv.innerHTML = `
                    <h4 style="color: var(--error);">‚úó Mauvaise r√©ponse</h4>
                    <p style="margin-bottom: 15px;"><strong>La bonne r√©ponse √©tait : ${formattedAnswer} ${item.unit}</strong></p>
                    <p>${currentItem.explanation}</p>
                `;
                // Afficher le bouton r√©essayer si une version alternative existe et qu'on ne l'utilise pas d√©j√†
                if (item.alt && !usingAltVersion) {
                    document.getElementById('btn-retry').style.display = 'block';
                }
            }

            explanationDiv.classList.add('show');
            document.getElementById('btn-skip').style.display = 'none';
            document.getElementById('exercise-buttons').style.display = 'flex';
        }

        function retryExercise() {
            usingAltVersion = true;
            renderQuestion();
        }

        function updateOutputGapGraph() {
            // R√©cup√©rer les valeurs des curseurs
            const initialGap = parseFloat(document.getElementById('initial_gap').value);
            const gPotential = parseFloat(document.getElementById('g_potential').value);
            const gEffective = parseFloat(document.getElementById('g_effective').value);

            // Mettre √† jour les affichages des valeurs
            document.getElementById('initial_gap-value').textContent = initialGap.toFixed(1).replace('.', ',') + ' %';
            document.getElementById('g_potential-value').textContent = gPotential.toFixed(1).replace('.', ',') + ' %';
            document.getElementById('g_effective-value').textContent = gEffective.toFixed(1).replace('.', ',') + ' %';

            // Afficher/masquer le bouton "Fermer l'√©cart" selon l'√©cart initial
            const btnCloseGap = document.getElementById('btn-close-gap');
            if (btnCloseGap) {
                btnCloseGap.style.display = (initialGap !== 0) ? 'block' : 'none';
            }

            // Calculer les donn√©es sur 5 ans (n+5)
            const years = 6;
            const pibPotentiel = [100]; // Base 100
            const pibEffectif = [100 * (1 + initialGap / 100)]; // Ajust√© de l'√©cart initial

            for (let i = 1; i < years; i++) {
                pibPotentiel.push(pibPotentiel[i-1] * (1 + gPotential / 100));
                pibEffectif.push(pibEffectif[i-1] * (1 + gEffective / 100));
            }

            // Calculer l'√©cart final
            const finalGap = ((pibEffectif[years-1] - pibPotentiel[years-1]) / pibPotentiel[years-1] * 100);

            // Mettre √† jour les r√©sultats
            document.getElementById('result-initial-gap').textContent = initialGap.toFixed(1).replace('.', ',') + ' %';
            document.getElementById('result-final-gap').textContent = finalGap.toFixed(1).replace('.', ',') + ' %';

            // Fonction pour mettre √† jour un statut d'√©cart
            function updateGapStatus(elementId, gapValue) {
                const statusEl = document.getElementById(elementId);
                if (!statusEl) return;
                if (Math.abs(gapValue) < 0.3) {
                    statusEl.textContent = '‚úì √âconomie √† son potentiel';
                    statusEl.style.background = 'var(--success-bg)';
                    statusEl.style.color = 'var(--success)';
                } else if (gapValue > 0) {
                    statusEl.textContent = 'üî• Surchauffe';
                    statusEl.style.background = '#fef3c7';
                    statusEl.style.color = '#d97706';
                } else {
                    statusEl.textContent = '‚ùÑÔ∏è Sous-r√©gime';
                    statusEl.style.background = '#dbeafe';
                    statusEl.style.color = '#2563eb';
                }
            }

            // Mettre √† jour les statuts (surchauffe ou sous-emploi) pour les deux √©carts
            updateGapStatus('gap-status-initial', initialGap);
            updateGapStatus('gap-status-final', finalGap);

            // Dessiner le graphique
            const canvas = document.getElementById('outputGapCanvas');
            const ctx = canvas.getContext('2d');

            // Dimensions
            const width = canvas.width;
            const height = canvas.height;
            const padding = { top: 30, right: 30, bottom: 50, left: 60 };
            const graphWidth = width - padding.left - padding.right;
            const graphHeight = height - padding.top - padding.bottom;

            // Effacer le canvas
            ctx.clearRect(0, 0, width, height);

            // Trouver les min/max pour l'√©chelle
            const allValues = [...pibPotentiel, ...pibEffectif];
            const minVal = Math.min(...allValues) * 0.98;
            const maxVal = Math.max(...allValues) * 1.02;

            // Fonctions de conversion
            const xScale = (i) => padding.left + (i / (years - 1)) * graphWidth;
            const yScale = (v) => padding.top + graphHeight - ((v - minVal) / (maxVal - minVal)) * graphHeight;

            // Dessiner la grille
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (i / 5) * graphHeight;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(width - padding.right, y);
                ctx.stroke();
            }

            // Dessiner les axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top);
            ctx.lineTo(padding.left, height - padding.bottom);
            ctx.lineTo(width - padding.right, height - padding.bottom);
            ctx.stroke();

            // Labels axe X (ann√©es)
            ctx.fillStyle = '#666';
            ctx.font = '12px Segoe UI, sans-serif';
            ctx.textAlign = 'center';
            for (let i = 0; i < years; i++) {
                const label = i === 0 ? '0' : 'n+' + i;
                ctx.fillText(label, xScale(i), height - padding.bottom + 20);
            }
            ctx.fillText('Ann√©es', width / 2, height - 10);

            // Labels axe Y
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const val = minVal + (i / 5) * (maxVal - minVal);
                const y = padding.top + graphHeight - (i / 5) * graphHeight;
                ctx.fillText(val.toFixed(0), padding.left - 10, y + 4);
            }
            ctx.save();
            ctx.translate(15, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText('PIB (base 100)', 0, 0);
            ctx.restore();

            // Dessiner la courbe du PIB potentiel (rouge pointill√©)
            ctx.strokeStyle = '#dc2626';
            ctx.lineWidth = 3;
            ctx.setLineDash([8, 4]);
            ctx.beginPath();
            for (let i = 0; i < years; i++) {
                const x = xScale(i);
                const y = yScale(pibPotentiel[i]);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Dessiner la courbe du PIB effectif (bleu plein)
            ctx.strokeStyle = '#2563eb';
            ctx.lineWidth = 3;
            ctx.setLineDash([]);
            ctx.beginPath();
            for (let i = 0; i < years; i++) {
                const x = xScale(i);
                const y = yScale(pibEffectif[i]);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Colorier la zone entre les deux courbes
            // Bleu froid = sous-emploi (PIB effectif < potentiel), Orange chaud = surchauffe (PIB effectif > potentiel)
            ctx.fillStyle = finalGap < 0 ? 'rgba(59, 130, 246, 0.2)' : 'rgba(249, 115, 22, 0.2)';
            ctx.beginPath();
            for (let i = 0; i < years; i++) {
                const x = xScale(i);
                const y = yScale(pibEffectif[i]);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            for (let i = years - 1; i >= 0; i--) {
                const x = xScale(i);
                const y = yScale(pibPotentiel[i]);
                ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.fill();

            // L√©gende
            ctx.font = '14px Segoe UI, sans-serif';
            const legendX = width - padding.right - 180;
            const legendY = padding.top + 10;

            ctx.fillStyle = '#2563eb';
            ctx.fillRect(legendX, legendY, 20, 3);
            ctx.fillStyle = '#333';
            ctx.textAlign = 'left';
            ctx.fillText('PIB effectif', legendX + 30, legendY + 5);

            ctx.strokeStyle = '#dc2626';
            ctx.setLineDash([5, 3]);
            ctx.beginPath();
            ctx.moveTo(legendX, legendY + 25);
            ctx.lineTo(legendX + 20, legendY + 25);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillText('PIB potentiel', legendX + 30, legendY + 28);
        }

        function closeGapIn5Years() {
            const initialGap = parseFloat(document.getElementById('initial_gap').value);
            const gPotential = parseFloat(document.getElementById('g_potential').value);

            if (initialGap === 0) {
                document.getElementById('simulation-explanation').innerHTML =
                    '<strong>L\'√©cart est d√©j√† nul !</strong> Le PIB effectif est √©gal au PIB potentiel.';
                return;
            }

            // Calculer le taux de croissance effective n√©cessaire pour fermer l'√©cart en 5 ans
            // PIB effectif initial * (1 + g_eff)^5 = PIB potentiel initial * (1 + g_pot)^5
            const pibEffectifInitial = 100 * (1 + initialGap / 100);
            const pibPotentielFinal = 100 * Math.pow(1 + gPotential / 100, 5);
            const gEffectiveNeeded = (Math.pow(pibPotentielFinal / pibEffectifInitial, 1/5) - 1) * 100;

            // Limiter aux bornes du curseur
            const gEffectiveClamped = Math.max(-1, Math.min(4, gEffectiveNeeded));

            // Mettre √† jour le curseur
            document.getElementById('g_effective').value = gEffectiveClamped.toFixed(1);
            updateOutputGapGraph();

            // Afficher le message p√©dagogique
            const message = `<strong>Fermeture de l'√©cart en 5 ans :</strong> Avec un √©cart de production initial de ${initialGap.toFixed(1).replace('.', ',')} % et une croissance potentielle de ${gPotential.toFixed(1).replace('.', ',')} %, il faut que la croissance effective s'√©l√®ve √† ${gEffectiveClamped.toFixed(1).replace('.', ',')} % par an sur la p√©riode pour ramener le PIB √† son niveau potentiel apr√®s 5 ans.`;

            if (gEffectiveNeeded > 4 || gEffectiveNeeded < -1) {
                document.getElementById('simulation-explanation').innerHTML = message +
                    `<br><br><em>Note : le taux calcul√© (${gEffectiveNeeded.toFixed(1).replace('.', ',')} %) d√©passe les bornes r√©alistes du curseur.</em>`;
            } else {
                document.getElementById('simulation-explanation').innerHTML = message;
            }
        }

        // ==========================================
        // SIMULATION : DYNAMIQUE DE L'ENDETTEMENT
        // ==========================================
        function updateDebtDynamicsGraph() {
            // R√©cup√©rer les valeurs des curseurs
            const debtInitial = parseFloat(document.getElementById('debt_initial').value);
            const gReal = parseFloat(document.getElementById('g_real').value);
            const inflation = parseFloat(document.getElementById('inflation').value);
            const rInterest = parseFloat(document.getElementById('r_interest').value);
            const primaryBalance = parseFloat(document.getElementById('primary_balance').value);

            // Calculer la croissance nominale
            const gNominal = gReal + inflation;
            const rMinusG = rInterest - gNominal;

            // Mettre √† jour les affichages des valeurs
            document.getElementById('debt_initial-value').textContent = debtInitial.toFixed(0) + ' %';
            document.getElementById('g_real-value').textContent = gReal.toFixed(1).replace('.', ',') + ' %';
            document.getElementById('inflation-value').textContent = inflation.toFixed(1).replace('.', ',') + ' %';
            document.getElementById('r_interest-value').textContent = rInterest.toFixed(1).replace('.', ',') + ' %';
            document.getElementById('primary_balance-value').textContent = (primaryBalance >= 0 ? '+' : '') + primaryBalance.toFixed(1).replace('.', ',') + ' %';

            // Calculer l'√©volution de la dette sur 10 ans
            const years = 11;
            const debtPath = [debtInitial];

            for (let i = 1; i < years; i++) {
                // √âquation simplifi√©e : d(t+1) = d(t) + d(t) * (r - g) - s
                const snowballEffect = debtPath[i-1] * rMinusG / 100;
                const newDebt = debtPath[i-1] + snowballEffect - primaryBalance;
                debtPath.push(Math.max(0, newDebt)); // La dette ne peut pas √™tre n√©gative
            }

            const finalDebt = debtPath[years - 1];
            const debtChange = finalDebt - debtInitial;

            // Mettre √† jour les r√©sultats
            document.getElementById('result-g-nominal').textContent = gNominal.toFixed(1).replace('.', ',') + ' %';
            document.getElementById('result-r-minus-g').textContent = (rMinusG >= 0 ? '+' : '') + rMinusG.toFixed(1).replace('.', ',') + ' %';
            document.getElementById('result-debt-final').textContent = finalDebt.toFixed(0).replace('.', ',') + ' %';

            // Mettre √† jour le statut de l'effet boule de neige
            const snowballStatus = document.getElementById('snowball-status');
            if (Math.abs(rMinusG) < 0.2) {
                snowballStatus.textContent = '‚âà Neutre';
                snowballStatus.style.background = '#f3f4f6';
                snowballStatus.style.color = '#6b7280';
            } else if (rMinusG > 0) {
                snowballStatus.textContent = '‚ö†Ô∏è Effet boule de neige';
                snowballStatus.style.background = '#fef3c7';
                snowballStatus.style.color = '#d97706';
            } else {
                snowballStatus.textContent = '‚úì Effet siphon';
                snowballStatus.style.background = 'var(--success-bg)';
                snowballStatus.style.color = 'var(--success)';
            }

            // Mettre √† jour le statut de la tendance de la dette
            const debtTrend = document.getElementById('debt-trend');
            if (Math.abs(debtChange) < 2) {
                debtTrend.textContent = '‚âà Stable';
                debtTrend.style.background = 'var(--success-bg)';
                debtTrend.style.color = 'var(--success)';
            } else if (debtChange > 0) {
                debtTrend.textContent = 'üìà En hausse (' + (debtChange > 0 ? '+' : '') + debtChange.toFixed(0) + ' pts)';
                debtTrend.style.background = 'var(--error-bg)';
                debtTrend.style.color = 'var(--error)';
            } else {
                debtTrend.textContent = 'üìâ En baisse (' + debtChange.toFixed(0) + ' pts)';
                debtTrend.style.background = 'var(--success-bg)';
                debtTrend.style.color = 'var(--success)';
            }

            // Dessiner le graphique
            const canvas = document.getElementById('debtDynamicsCanvas');
            const ctx = canvas.getContext('2d');

            // Dimensions
            const width = canvas.width;
            const height = canvas.height;
            const padding = { top: 30, right: 30, bottom: 50, left: 70 };
            const graphWidth = width - padding.left - padding.right;
            const graphHeight = height - padding.top - padding.bottom;

            // Effacer le canvas
            ctx.clearRect(0, 0, width, height);

            // Trouver les min/max pour l'√©chelle
            const minVal = Math.min(...debtPath, debtInitial * 0.9) * 0.95;
            const maxVal = Math.max(...debtPath, debtInitial * 1.1) * 1.05;

            // Fonctions de conversion
            const xScale = (i) => padding.left + (i / (years - 1)) * graphWidth;
            const yScale = (v) => padding.top + graphHeight - ((v - minVal) / (maxVal - minVal)) * graphHeight;

            // Dessiner la grille horizontale
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (i / 5) * graphHeight;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(width - padding.right, y);
                ctx.stroke();
            }

            // Dessiner la ligne de r√©f√©rence (endettement initial)
            ctx.strokeStyle = '#9ca3af';
            ctx.lineWidth = 1;
            ctx.setLineDash([4, 4]);
            const yInitial = yScale(debtInitial);
            ctx.beginPath();
            ctx.moveTo(padding.left, yInitial);
            ctx.lineTo(width - padding.right, yInitial);
            ctx.stroke();
            ctx.setLineDash([]);

            // Dessiner les axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top);
            ctx.lineTo(padding.left, height - padding.bottom);
            ctx.lineTo(width - padding.right, height - padding.bottom);
            ctx.stroke();

            // Labels axe X (ann√©es)
            ctx.fillStyle = '#666';
            ctx.font = '12px Segoe UI, sans-serif';
            ctx.textAlign = 'center';
            for (let i = 0; i < years; i++) {
                const label = i === 0 ? 'n' : 'n+' + i;
                ctx.fillText(label, xScale(i), height - padding.bottom + 20);
            }
            ctx.fillText('Ann√©es', width / 2, height - 10);

            // Labels axe Y
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const val = minVal + (i / 5) * (maxVal - minVal);
                const y = padding.top + graphHeight - (i / 5) * graphHeight;
                ctx.fillText(val.toFixed(0) + ' %', padding.left - 10, y + 4);
            }
            ctx.save();
            ctx.translate(18, height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText('Dette / PIB', 0, 0);
            ctx.restore();

            // Colorier la zone sous la courbe
            const isIncreasing = finalDebt > debtInitial;
            ctx.fillStyle = isIncreasing ? 'rgba(239, 68, 68, 0.15)' : 'rgba(34, 197, 94, 0.15)';
            ctx.beginPath();
            ctx.moveTo(xScale(0), yScale(debtInitial));
            for (let i = 0; i < years; i++) {
                ctx.lineTo(xScale(i), yScale(debtPath[i]));
            }
            ctx.lineTo(xScale(years - 1), yScale(debtInitial));
            ctx.closePath();
            ctx.fill();

            // Dessiner la courbe de la dette
            ctx.strokeStyle = isIncreasing ? '#dc2626' : '#22c55e';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let i = 0; i < years; i++) {
                const x = xScale(i);
                const y = yScale(debtPath[i]);
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // Dessiner les points
            ctx.fillStyle = isIncreasing ? '#dc2626' : '#22c55e';
            for (let i = 0; i < years; i++) {
                ctx.beginPath();
                ctx.arc(xScale(i), yScale(debtPath[i]), 4, 0, Math.PI * 2);
                ctx.fill();
            }

            // L√©gende
            ctx.font = '12px Segoe UI, sans-serif';
            const legendX = width - padding.right - 200;
            const legendY = padding.top + 10;

            ctx.fillStyle = isIncreasing ? '#dc2626' : '#22c55e';
            ctx.fillRect(legendX, legendY, 20, 3);
            ctx.fillStyle = '#333';
            ctx.textAlign = 'left';
            ctx.fillText('Trajectoire de la dette', legendX + 30, legendY + 5);

            ctx.strokeStyle = '#9ca3af';
            ctx.setLineDash([4, 4]);
            ctx.beginPath();
            ctx.moveTo(legendX, legendY + 20);
            ctx.lineTo(legendX + 20, legendY + 20);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillText('Niveau initial (' + debtInitial + ' %)', legendX + 30, legendY + 23);
        }

        function stabilizeDebt() {
            const debtInitial = parseFloat(document.getElementById('debt_initial').value);
            const gReal = parseFloat(document.getElementById('g_real').value);
            const inflation = parseFloat(document.getElementById('inflation').value);
            const rInterest = parseFloat(document.getElementById('r_interest').value);

            const gNominal = gReal + inflation;
            const rMinusG = rInterest - gNominal;

            // Solde primaire stabilisant : s* = d * (r - g)
            const stabilizingBalance = debtInitial * rMinusG / 100;

            // Limiter aux bornes du curseur
            const balanceClamped = Math.max(-5, Math.min(3, stabilizingBalance));

            // Mettre √† jour le curseur
            document.getElementById('primary_balance').value = balanceClamped.toFixed(1);
            updateDebtDynamicsGraph();

            // Afficher le message p√©dagogique
            const balanceType = stabilizingBalance >= 0 ? 'exc√©dent' : 'd√©ficit';
            const balanceAbs = Math.abs(stabilizingBalance).toFixed(1).replace('.', ',');

            let message = `<strong>Solde primaire stabilisant :</strong> Avec un endettement de ${debtInitial} % du PIB, un taux d'int√©r√™t de ${rInterest.toFixed(1).replace('.', ',')} % et une croissance nominale de ${gNominal.toFixed(1).replace('.', ',')} %, il faut un ${balanceType} primaire de <strong>${balanceAbs} % du PIB</strong> pour stabiliser le ratio d'endettement.`;

            if (rMinusG > 0) {
                message += `<br><br><em>Note : l'effet boule de neige √©tant d√©favorable (r > g), il faut d√©gager un exc√©dent primaire pour simplement stabiliser la dette.</em>`;
            } else if (rMinusG < 0) {
                message += `<br><br><em>Note : l'effet siphon √©tant favorable (r < g), la dette peut √™tre stabilis√©e m√™me avec un l√©ger d√©ficit primaire.</em>`;
            }

            if (stabilizingBalance > 3 || stabilizingBalance < -5) {
                message += `<br><br><em>‚ö†Ô∏è Le solde calcul√© (${stabilizingBalance.toFixed(1).replace('.', ',')} %) d√©passe les bornes r√©alistes du curseur.</em>`;
            }

            document.getElementById('debt-simulation-explanation').innerHTML = message;
        }

        function nextQuestion() {
            currentIndex++;
            usingAltVersion = false;
            updateProgress();
            renderQuestion();
        }

        function updateProgress() {
            document.getElementById('current-q').textContent = Math.min(currentIndex + 1, currentQuestions.length);
            document.getElementById('total-q').textContent = currentQuestions.length;

            const progress = currentQuestions.length > 0 ? (currentIndex / currentQuestions.length) * 100 : 0;
            document.getElementById('progress-fill').style.width = `${progress}%`;
        }

        function showResults() {
            const container = document.getElementById('question-container');
            const percentage = Math.round((score / currentQuestions.length) * 100);

            container.innerHTML = `
                <div class="results-card">
                    <h2>R√©sultats</h2>
                    <div class="results-score">${score}/${currentQuestions.length}</div>
                    <p class="results-details">${percentage}% de bonnes r√©ponses</p>
                    <button class="btn-restart" onclick="backToMenu()">Retour au menu</button>
                </div>
            `;
        }

        function backToMenu() {
            document.getElementById('quiz').style.display = 'none';
            document.getElementById('menu').style.display = 'block';
            currentQuestions = [];
            currentIndex = 0;
            score = 0;
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Formater un nombre selon les conventions fran√ßaises
        // - Virgule comme s√©parateur d√©cimal
        // - Espace ins√©cable comme s√©parateur de milliers
        // - Espace apr√®s le signe moins
        function formatNumber(num, decimals = null) {
            const isNegative = num < 0;
            const absNum = Math.abs(num);

            // Formater avec les d√©cimales
            let formatted;
            if (decimals !== null) {
                formatted = absNum.toFixed(decimals);
            } else {
                // Garder les d√©cimales existantes
                formatted = absNum.toString();
            }

            // S√©parer partie enti√®re et d√©cimale
            const parts = formatted.split('.');
            let intPart = parts[0];
            const decPart = parts[1];

            // Ajouter les s√©parateurs de milliers (espace ins√©cable)
            intPart = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');

            // Reconstruire avec virgule comme s√©parateur d√©cimal
            if (decPart) {
                formatted = intPart + ',' + decPart;
            } else {
                formatted = intPart;
            }

            // Ajouter le signe moins avec espace
            if (isNegative) {
                formatted = '- ' + formatted;
            }

            return formatted;
        }

        // D√©marrage
        init();
    </script>
</body>
</html>
